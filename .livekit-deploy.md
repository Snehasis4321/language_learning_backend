# Deploy Agent to LiveKit Cloud

## Prerequisites

1. **LiveKit Cloud account**: https://cloud.livekit.io
2. **LiveKit CLI installed**:
   ```bash
   # macOS
   brew install livekit-cli

   # Linux/WSL
   curl -sSL https://get.livekit.io/cli | bash
   ```

3. **Verify installation**:
   ```bash
   lk --version
   ```

## Step 1: Build the Standalone Agent

```bash
# Install dependencies
pnpm install

# Build TypeScript
pnpm build

# Verify the standalone agent builds
ls -la dist/agent/standalone/language-teacher.js
```

## Step 2: Authenticate with LiveKit Cloud

```bash
# Login to LiveKit Cloud
lk cloud auth

# This will open your browser for authentication
# Follow the prompts
```

## Step 3: Deploy the Agent

```bash
# Deploy to LiveKit Cloud
lk cloud deploy agent \
  --name language-teacher \
  --config livekit.yaml
```

Or deploy directly with CLI (without yaml):

```bash
lk cloud deploy agent \
  --name language-teacher \
  --file dist/agent/standalone/language-teacher.js \
  --runtime nodejs20 \
  --min-instances 0 \
  --max-instances 5 \
  --cpu 1 \
  --memory 1Gi
```

## Step 4: Set Environment Variables (Secrets)

**Important**: Don't put API keys in `livekit.yaml`! Set them as secrets:

```bash
# Set Cerebras API key
lk cloud agent secret set CEREBRAS_API_KEY your-cerebras-api-key-here

# Set OpenAI API key (for STT/TTS)
lk cloud agent secret set OPENAI_API_KEY your-openai-api-key-here

# Optional: Set custom Cerebras URL
lk cloud agent secret set CEREBRAS_API_URL https://api.cerebras.ai/v1
```

## Step 5: Verify Deployment

```bash
# List deployed agents
lk cloud agent list

# View agent logs
lk cloud agent logs language-teacher --follow

# Check agent status
lk cloud agent status language-teacher
```

## Step 6: Test Your Agent

1. **Create a test room**:
   ```bash
   lk room create test-language-room
   ```

2. **Join from your frontend**:
   - Use the same LiveKit credentials
   - Start a voice chat session
   - The agent should auto-join the room

3. **Monitor logs**:
   ```bash
   lk cloud agent logs language-teacher --follow
   ```

## Deployment Commands Summary

```bash
# Quick deploy (one command)
lk cloud deploy agent \
  --name language-teacher \
  --config livekit.yaml

# Set secrets
lk cloud agent secret set CEREBRAS_API_KEY <key>
lk cloud agent secret set OPENAI_API_KEY <key>

# View logs
lk cloud agent logs language-teacher --follow

# Update deployment (after code changes)
pnpm build
lk cloud deploy agent --name language-teacher --config livekit.yaml

# Delete deployment
lk cloud agent delete language-teacher
```

## Free Tier Limits

✅ **1 agent deployment** included in free tier
✅ **1,000 agent session minutes/month**
✅ **5 concurrent agent sessions**
✅ **Deployment metrics** included

## Troubleshooting

**Agent not starting:**
```bash
# Check logs for errors
lk cloud agent logs language-teacher

# Common issues:
# 1. Missing CEREBRAS_API_KEY secret
# 2. Missing OPENAI_API_KEY secret
# 3. Build errors in dist/agent/standalone/language-teacher.js
```

**Agent not joining rooms:**
```bash
# Verify agent is running
lk cloud agent status language-teacher

# Check if agent worker is registered
lk cloud agent list

# Verify room exists
lk room list
```

**High latency:**
- Agent runs in LiveKit Cloud's region (us-east-1 by default)
- Consider self-hosting if you need specific region

## Cost Estimates (Free Tier)

- **LiveKit hosting**: $0 (free tier)
- **1,000 agent minutes**: ~200 conversations @ 5min each
- **API costs** (your responsibility):
  - Cerebras: ~$0.60 per 1M tokens
  - OpenAI STT: $0.006/min
  - OpenAI TTS: $15 per 1M chars

**Example for 200 conversations:**
- LiveKit: $0
- STT: 200 × 5 × $0.006 = $6
- TTS: ~$4
- LLM: ~$1
- **Total: ~$11/month**

## When to Self-Host Instead

Self-host on your VPS if you need:
- More than 1,000 agent minutes/month
- Custom integrations with your backend
- Specific geographic region
- More control over agent lifecycle

For hackathon demo: **LiveKit Cloud deployment is perfect!**
